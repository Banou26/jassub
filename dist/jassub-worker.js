"use strict";String.prototype.startsWith||(String.prototype.startsWith=function(i,c){return c===void 0&&(c=0),this.substring(c,i.length)===i});String.prototype.includes||(String.prototype.includes=function(i,c){return this.indexOf(i,c)!==-1});if(!ArrayBuffer.isView){const i=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];ArrayBuffer.isView=c=>c&&c.constructor&&i.indexOf(c.constructor)!==-1}Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(i,c){return new Uint8Array(this.subarray(i,c))});Date.now||(Date.now=()=>new Date().getTime());if(typeof console>"u"){const i=(c,p)=>{postMessage({target:"console",command:c,content:JSON.stringify(Array.prototype.slice.call(p))})};console={log:function(){i("log",arguments)},debug:function(){i("debug",arguments)},info:function(){i("info",arguments)},warn:function(){i("warn",arguments)},error:function(){i("error",arguments)}},console.log("overridden console")}var Ze={},En={get exports(){return Ze},set exports(i){Ze=i}};(function(i,c){var p=(()=>{var g=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return function(a){a=a||{};var a=typeof a<"u"?a:{},w,_;a.ready=new Promise(function(e,r){w=e,_=r});var b=Object.assign({},a),P=(e,r)=>{throw r},T="";function U(e){return a.locateFile?a.locateFile(e,T):T+e}var S;T=self.location.href,g&&(T=g),T.indexOf("blob:")!==0?T=T.substr(0,T.replace(/[?#].*/,"").lastIndexOf("/")+1):T="",S=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)};var re=console.log.bind(console),x=console.warn.bind(console);Object.assign(a,b),b=null;var ye;typeof WebAssembly!="object"&&Y("no native wasm support detected");var K,me=!1;function We(e,r){e||Y(r)}var be=new TextDecoder("utf8");function Me(e,r,t){for(var n=r+t,s=r;e[s]&&!(s>=n);)++s;return be.decode(e.buffer?e.subarray(r,s):new Uint8Array(e.slice(r,s)))}function Q(e,r){if(!e)return"";for(var t=e+r,n=e;!(n>=t)&&$[n];)++n;return be.decode($.subarray(e,n))}function Ie(e,r,t,n){if(!(n>0))return 0;for(var s=t,l=t+n-1,f=0;f<e.length;++f){var o=e.charCodeAt(f);if(o>=55296&&o<=57343){var u=e.charCodeAt(++f);o=65536+((o&1023)<<10)|u&1023}if(o<=127){if(t>=l)break;r[t++]=o}else if(o<=2047){if(t+1>=l)break;r[t++]=192|o>>6,r[t++]=128|o&63}else if(o<=65535){if(t+2>=l)break;r[t++]=224|o>>12,r[t++]=128|o>>6&63,r[t++]=128|o&63}else{if(t+3>=l)break;r[t++]=240|o>>18,r[t++]=128|o>>12&63,r[t++]=128|o>>6&63,r[t++]=128|o&63}}return r[t]=0,t-s}function He(e,r,t){return Ie(e,$,r,t)}function Le(e){for(var r=0,t=0;t<e.length;++t){var n=e.charCodeAt(t);n<=127?r++:n<=2047?r+=2:n>=55296&&n<=57343?(r+=4,++t):r+=3}return r}var te,ne,$,ie,_e,G,k,ir,sr;function ar(e){te=e,a.HEAP8=ne=new Int8Array(e),a.HEAP16=ie=new Int16Array(e),a.HEAP32=G=new Int32Array(e),a.HEAPU8=$=new Uint8Array(e),a.HEAPU16=_e=new Uint16Array(e),a.HEAPU32=k=new Uint32Array(e),a.HEAPF32=ir=new Float32Array(e),a.HEAPF64=sr=new Float64Array(e)}var or,Br=[],ur=[],Vr=[];function zr(){xe(Br)}function Gr(){xe(ur)}function qr(){xe(Vr)}function Jr(e){ur.unshift(e)}var se=0,ae=null;function Xr(e){se++}function Kr(e){if(se--,se==0&&ae){var r=ae;ae=null,r()}}function Y(e){e="Aborted("+e+")",x(e),me=!0,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw _(r),r}var Qr="data:application/octet-stream;base64,";function lr(e){return e.startsWith(Qr)}var D;D="jassub-worker.wasm",lr(D)||(D=U(D));function fr(e){try{if(e==D&&ye)return new Uint8Array(ye);if(S)return S(e);throw"both async and sync fetching of the wasm failed"}catch(r){Y(r)}}function Yr(){return typeof fetch=="function"?fetch(D,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+D+"'";return e.arrayBuffer()}).catch(function(){return fr(D)}):Promise.resolve().then(function(){return fr(D)})}function Zr(){var e={a:Fn};function r(f,o){var u=f.exports;a.asm=u,K=a.asm.I,ar(K.buffer),or=a.asm.O,Jr(a.asm.J),Kr()}Xr();function t(f){r(f.instance)}function n(f){return Yr().then(function(o){return WebAssembly.instantiate(o,e)}).then(function(o){return o}).then(f,function(o){x("failed to asynchronously prepare wasm: "+o),Y(o)})}function s(){return typeof WebAssembly.instantiateStreaming=="function"&&!lr(D)&&typeof fetch=="function"?fetch(D,{credentials:"same-origin"}).then(function(f){var o=WebAssembly.instantiateStreaming(f,e);return o.then(t,function(u){return x("wasm streaming compile failed: "+u),x("falling back to ArrayBuffer instantiation"),n(t)})}):n(t)}if(a.instantiateWasm)try{var l=a.instantiateWasm(e,r);return l}catch(f){x("Module.instantiateWasm callback failed with error: "+f),_(f)}return s().catch(_),{}}function Nr(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function xe(e){for(;e.length>0;)e.shift()(a)}function et(e,r,t,n){Y("Assertion failed: "+Q(e)+", at: "+[r?Q(r):"unknown filename",t,n?Q(n):"unknown function"])}function rt(e,r,t){return 0}function tt(e,r,t){}function nt(e,r,t){return 0}function it(e,r,t,n){}function st(e,r,t,n,s){}function Be(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}function at(){for(var e=new Array(256),r=0;r<256;++r)e[r]=String.fromCharCode(r);cr=e}var cr=void 0;function O(e){for(var r="",t=e;$[t];)r+=cr[$[t++]];return r}var Z={},q={},we={},ot=48,ut=57;function Ve(e){if(e===void 0)return"_unknown";e=e.replace(/[^a-zA-Z0-9_]/g,"$");var r=e.charCodeAt(0);return r>=ot&&r<=ut?"_"+e:e}function ze(e,r){return e=Ve(e),new Function("body","return function "+e+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(r)}function Ge(e,r){var t=ze(r,function(n){this.name=r,this.message=n;var s=new Error(n).stack;s!==void 0&&(this.stack=this.toString()+`
`+s.replace(/^Error(:[^\n]*)?\n/,""))});return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},t}var N=void 0;function m(e){throw new N(e)}var dr=void 0;function Ce(e){throw new dr(e)}function J(e,r,t){e.forEach(function(o){we[o]=r});function n(o){var u=t(o);u.length!==e.length&&Ce("Mismatched type converter count");for(var d=0;d<e.length;++d)M(e[d],u[d])}var s=new Array(r.length),l=[],f=0;r.forEach((o,u)=>{q.hasOwnProperty(o)?s[u]=q[o]:(l.push(o),Z.hasOwnProperty(o)||(Z[o]=[]),Z[o].push(()=>{s[u]=q[o],++f,f===l.length&&n(s)}))}),l.length===0&&n(s)}function M(e,r,t={}){if(!("argPackAdvance"in r))throw new TypeError("registerType registeredInstance requires argPackAdvance");var n=r.name;if(e||m('type "'+n+'" must have a positive integer typeid pointer'),q.hasOwnProperty(e)){if(t.ignoreDuplicateRegistrations)return;m("Cannot register type '"+n+"' twice")}if(q[e]=r,delete we[e],Z.hasOwnProperty(e)){var s=Z[e];delete Z[e],s.forEach(l=>l())}}function lt(e,r,t,n,s){var l=Be(t);r=O(r),M(e,{name:r,fromWireType:function(f){return!!f},toWireType:function(f,o){return o?n:s},argPackAdvance:8,readValueFromPointer:function(f){var o;if(t===1)o=ne;else if(t===2)o=ie;else if(t===4)o=G;else throw new TypeError("Unknown boolean type size: "+r);return this.fromWireType(o[f>>l])},destructorFunction:null})}function ft(e){if(!(this instanceof B)||!(e instanceof B))return!1;for(var r=this.$$.ptrType.registeredClass,t=this.$$.ptr,n=e.$$.ptrType.registeredClass,s=e.$$.ptr;r.baseClass;)t=r.upcast(t),r=r.baseClass;for(;n.baseClass;)s=n.upcast(s),n=n.baseClass;return r===n&&t===s}function ct(e){return{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType}}function qe(e){function r(t){return t.$$.ptrType.registeredClass.name}m(r(e)+" instance already deleted")}var Je=!1;function pr(e){}function dt(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}function gr(e){e.count.value-=1;var r=e.count.value===0;r&&dt(e)}function vr(e,r,t){if(r===t)return e;if(t.baseClass===void 0)return null;var n=vr(e,r,t.baseClass);return n===null?null:t.downcast(n)}var hr={};function pt(){return Object.keys(le).length}function gt(){var e=[];for(var r in le)le.hasOwnProperty(r)&&e.push(le[r]);return e}var oe=[];function Xe(){for(;oe.length;){var e=oe.pop();e.$$.deleteScheduled=!1,e.delete()}}var ue=void 0;function vt(e){ue=e,oe.length&&ue&&ue(Xe)}function ht(){a.getInheritedInstanceCount=pt,a.getLiveInheritedInstances=gt,a.flushPendingDeletes=Xe,a.setDelayFunction=vt}var le={};function yt(e,r){for(r===void 0&&m("ptr should not be undefined");e.baseClass;)r=e.upcast(r),e=e.baseClass;return r}function mt(e,r){return r=yt(e,r),le[r]}function Pe(e,r){(!r.ptrType||!r.ptr)&&Ce("makeClassHandle requires ptr and ptrType");var t=!!r.smartPtrType,n=!!r.smartPtr;return t!==n&&Ce("Both smartPtrType and smartPtr must be specified"),r.count={value:1},fe(Object.create(e,{$$:{value:r}}))}function bt(e){var r=this.getPointee(e);if(!r)return this.destructor(e),null;var t=mt(this.registeredClass,r);if(t!==void 0){if(t.$$.count.value===0)return t.$$.ptr=r,t.$$.smartPtr=e,t.clone();var n=t.clone();return this.destructor(e),n}function s(){return this.isSmartPointer?Pe(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:r,smartPtrType:this,smartPtr:e}):Pe(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var l=this.registeredClass.getActualType(r),f=hr[l];if(!f)return s.call(this);var o;this.isConst?o=f.constPointerType:o=f.pointerType;var u=vr(r,this.registeredClass,o.registeredClass);return u===null?s.call(this):this.isSmartPointer?Pe(o.registeredClass.instancePrototype,{ptrType:o,ptr:u,smartPtrType:this,smartPtr:e}):Pe(o.registeredClass.instancePrototype,{ptrType:o,ptr:u})}function fe(e){return typeof FinalizationRegistry>"u"?(fe=r=>r,e):(Je=new FinalizationRegistry(r=>{gr(r.$$)}),fe=r=>{var t=r.$$,n=!!t.smartPtr;if(n){var s={$$:t};Je.register(r,s,r)}return r},pr=r=>Je.unregister(r),fe(e))}function _t(){if(this.$$.ptr||qe(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e=fe(Object.create(Object.getPrototypeOf(this),{$$:{value:ct(this.$$)}}));return e.$$.count.value+=1,e.$$.deleteScheduled=!1,e}function wt(){this.$$.ptr||qe(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&m("Object already scheduled for deletion"),pr(this),gr(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Ct(){return!this.$$.ptr}function Pt(){return this.$$.ptr||qe(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&m("Object already scheduled for deletion"),oe.push(this),oe.length===1&&ue&&ue(Xe),this.$$.deleteScheduled=!0,this}function Tt(){B.prototype.isAliasOf=ft,B.prototype.clone=_t,B.prototype.delete=wt,B.prototype.isDeleted=Ct,B.prototype.deleteLater=Pt}function B(){}function yr(e,r,t){if(e[r].overloadTable===void 0){var n=e[r];e[r]=function(){return e[r].overloadTable.hasOwnProperty(arguments.length)||m("Function '"+t+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[r].overloadTable+")!"),e[r].overloadTable[arguments.length].apply(this,arguments)},e[r].overloadTable=[],e[r].overloadTable[n.argCount]=n}}function At(e,r,t){a.hasOwnProperty(e)?((t===void 0||a[e].overloadTable!==void 0&&a[e].overloadTable[t]!==void 0)&&m("Cannot register public name '"+e+"' twice"),yr(a,e,e),a.hasOwnProperty(t)&&m("Cannot register multiple overloads of a function with the same number of arguments ("+t+")!"),a[e].overloadTable[t]=r):(a[e]=r,t!==void 0&&(a[e].numArguments=t))}function $t(e,r,t,n,s,l,f,o){this.name=e,this.constructor=r,this.instancePrototype=t,this.rawDestructor=n,this.baseClass=s,this.getActualType=l,this.upcast=f,this.downcast=o,this.pureVirtualFunctions=[]}function Te(e,r,t){for(;r!==t;)r.upcast||m("Expected null or instance of "+t.name+", got an instance of "+r.name),e=r.upcast(e),r=r.baseClass;return e}function Ft(e,r){if(r===null)return this.isReference&&m("null is not a valid "+this.name),0;r.$$||m('Cannot pass "'+Qe(r)+'" as a '+this.name),r.$$.ptr||m("Cannot pass deleted object as a pointer of type "+this.name);var t=r.$$.ptrType.registeredClass,n=Te(r.$$.ptr,t,this.registeredClass);return n}function jt(e,r){var t;if(r===null)return this.isReference&&m("null is not a valid "+this.name),this.isSmartPointer?(t=this.rawConstructor(),e!==null&&e.push(this.rawDestructor,t),t):0;r.$$||m('Cannot pass "'+Qe(r)+'" as a '+this.name),r.$$.ptr||m("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&r.$$.ptrType.isConst&&m("Cannot convert argument of type "+(r.$$.smartPtrType?r.$$.smartPtrType.name:r.$$.ptrType.name)+" to parameter type "+this.name);var n=r.$$.ptrType.registeredClass;if(t=Te(r.$$.ptr,n,this.registeredClass),this.isSmartPointer)switch(r.$$.smartPtr===void 0&&m("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:r.$$.smartPtrType===this?t=r.$$.smartPtr:m("Cannot convert argument of type "+(r.$$.smartPtrType?r.$$.smartPtrType.name:r.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:t=r.$$.smartPtr;break;case 2:if(r.$$.smartPtrType===this)t=r.$$.smartPtr;else{var s=r.clone();t=this.rawShare(t,Fe.toHandle(function(){s.delete()})),e!==null&&e.push(this.rawDestructor,t)}break;default:m("Unsupporting sharing policy")}return t}function St(e,r){if(r===null)return this.isReference&&m("null is not a valid "+this.name),0;r.$$||m('Cannot pass "'+Qe(r)+'" as a '+this.name),r.$$.ptr||m("Cannot pass deleted object as a pointer of type "+this.name),r.$$.ptrType.isConst&&m("Cannot convert argument of type "+r.$$.ptrType.name+" to parameter type "+this.name);var t=r.$$.ptrType.registeredClass,n=Te(r.$$.ptr,t,this.registeredClass);return n}function Ae(e){return this.fromWireType(G[e>>2])}function Ot(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function kt(e){this.rawDestructor&&this.rawDestructor(e)}function Et(e){e!==null&&e.delete()}function Ut(){I.prototype.getPointee=Ot,I.prototype.destructor=kt,I.prototype.argPackAdvance=8,I.prototype.readValueFromPointer=Ae,I.prototype.deleteObject=Et,I.prototype.fromWireType=bt}function I(e,r,t,n,s,l,f,o,u,d,v){this.name=e,this.registeredClass=r,this.isReference=t,this.isConst=n,this.isSmartPointer=s,this.pointeeType=l,this.sharingPolicy=f,this.rawGetPointee=o,this.rawConstructor=u,this.rawShare=d,this.rawDestructor=v,!s&&r.baseClass===void 0?n?(this.toWireType=Ft,this.destructorFunction=null):(this.toWireType=St,this.destructorFunction=null):this.toWireType=jt}function Dt(e,r,t){a.hasOwnProperty(e)||Ce("Replacing nonexistant public symbol"),a[e].overloadTable!==void 0&&t!==void 0?a[e].overloadTable[t]=r:(a[e]=r,a[e].argCount=t)}function Rt(e,r,t){var n=a["dynCall_"+e];return t&&t.length?n.apply(null,[r].concat(t)):n.call(null,r)}var $e=[];function ce(e){var r=$e[e];return r||(e>=$e.length&&($e.length=e+1),$e[e]=r=or.get(e)),r}function Wt(e,r,t){if(e.includes("j"))return Rt(e,r,t);var n=ce(r).apply(null,t);return n}function Mt(e,r){var t=[];return function(){return t.length=0,Object.assign(t,arguments),Wt(e,r,t)}}function V(e,r){e=O(e);function t(){return e.includes("j")?Mt(e,r):ce(r)}var n=t();return typeof n!="function"&&m("unknown function pointer with signature "+e+": "+r),n}var mr=void 0;function br(e){var r=$r(e),t=O(r);return H(r),t}function de(e,r){var t=[],n={};function s(l){if(!n[l]&&!q[l]){if(we[l]){we[l].forEach(s);return}t.push(l),n[l]=!0}}throw r.forEach(s),new mr(e+": "+t.map(br).join([", "]))}function It(e,r,t,n,s,l,f,o,u,d,v,h,y){v=O(v),l=V(s,l),o&&(o=V(f,o)),d&&(d=V(u,d)),y=V(h,y);var A=Ve(v);At(A,function(){de("Cannot construct "+v+" due to unbound types",[n])}),J([e,r,t],n?[n]:[],function(F){F=F[0];var j,E;n?(j=F.registeredClass,E=j.instancePrototype):E=B.prototype;var W=ze(A,function(){if(Object.getPrototypeOf(this)!==pe)throw new N("Use 'new' to construct "+v);if(L.constructor_body===void 0)throw new N(v+" has no accessible constructor");var Or=L.constructor_body[arguments.length];if(Or===void 0)throw new N("Tried to invoke ctor of "+v+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(L.constructor_body).toString()+") parameters instead!");return Or.apply(this,arguments)}),pe=Object.create(E,{constructor:{value:W}});W.prototype=pe;var L=new $t(v,W,pe,y,j,l,o,d),kn=new I(v,L,!0,!1,!1),jr=new I(v+"*",L,!1,!1,!1),Sr=new I(v+" const*",L,!1,!0,!1);return hr[e]={pointerType:jr,constPointerType:Sr},Dt(A,W),[kn,jr,Sr]})}function _r(e,r){for(var t=[],n=0;n<e;n++)t.push(k[r+n*4>>2]);return t}function wr(e){for(;e.length;){var r=e.pop(),t=e.pop();t(r)}}function Ht(e,r){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var t=ze(e.name||"unknownFunctionName",function(){});t.prototype=e.prototype;var n=new t,s=e.apply(n,r);return s instanceof Object?s:n}function Cr(e,r,t,n,s){var l=r.length;l<2&&m("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var f=r[1]!==null&&t!==null,o=!1,u=1;u<r.length;++u)if(r[u]!==null&&r[u].destructorFunction===void 0){o=!0;break}for(var d=r[0].name!=="void",v="",h="",u=0;u<l-2;++u)v+=(u!==0?", ":"")+"arg"+u,h+=(u!==0?", ":"")+"arg"+u+"Wired";var y="return function "+Ve(e)+"("+v+`) {
if (arguments.length !== `+(l-2)+`) {
throwBindingError('function `+e+" called with ' + arguments.length + ' arguments, expected "+(l-2)+` args!');
}
`;o&&(y+=`var destructors = [];
`);var A=o?"destructors":"null",F=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],j=[m,n,s,wr,r[0],r[1]];f&&(y+="var thisWired = classParam.toWireType("+A+`, this);
`);for(var u=0;u<l-2;++u)y+="var arg"+u+"Wired = argType"+u+".toWireType("+A+", arg"+u+"); // "+r[u+2].name+`
`,F.push("argType"+u),j.push(r[u+2]);if(f&&(h="thisWired"+(h.length>0?", ":"")+h),y+=(d?"var rv = ":"")+"invoker(fn"+(h.length>0?", ":"")+h+`);
`,o)y+=`runDestructors(destructors);
`;else for(var u=f?1:2;u<r.length;++u){var E=u===1?"thisWired":"arg"+(u-2)+"Wired";r[u].destructorFunction!==null&&(y+=E+"_dtor("+E+"); // "+r[u].name+`
`,F.push(E+"_dtor"),j.push(r[u].destructorFunction))}d&&(y+=`var ret = retType.fromWireType(rv);
return ret;
`),y+=`}
`,F.push(y);var W=Ht(Function,F).apply(null,j);return W}function Lt(e,r,t,n,s,l){We(r>0);var f=_r(r,t);s=V(n,s),J([],[e],function(o){o=o[0];var u="constructor "+o.name;if(o.registeredClass.constructor_body===void 0&&(o.registeredClass.constructor_body=[]),o.registeredClass.constructor_body[r-1]!==void 0)throw new N("Cannot register multiple constructors with identical number of parameters ("+(r-1)+") for class '"+o.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return o.registeredClass.constructor_body[r-1]=()=>{de("Cannot construct "+o.name+" due to unbound types",f)},J([],f,function(d){return d.splice(1,0,null),o.registeredClass.constructor_body[r-1]=Cr(u,d,null,s,l),[]}),[]})}function xt(e,r,t,n,s,l,f,o){var u=_r(t,n);r=O(r),l=V(s,l),J([],[e],function(d){d=d[0];var v=d.name+"."+r;r.startsWith("@@")&&(r=Symbol[r.substring(2)]),o&&d.registeredClass.pureVirtualFunctions.push(r);function h(){de("Cannot call "+v+" due to unbound types",u)}var y=d.registeredClass.instancePrototype,A=y[r];return A===void 0||A.overloadTable===void 0&&A.className!==d.name&&A.argCount===t-2?(h.argCount=t-2,h.className=d.name,y[r]=h):(yr(y,r,v),y[r].overloadTable[t-2]=h),J([],u,function(F){var j=Cr(v,F,d,l,f);return y[r].overloadTable===void 0?(j.argCount=t-2,y[r]=j):y[r].overloadTable[t-2]=j,[]}),[]})}function Pr(e,r,t){return e instanceof Object||m(t+' with invalid "this": '+e),e instanceof r.registeredClass.constructor||m(t+' incompatible with "this" of type '+e.constructor.name),e.$$.ptr||m("cannot call emscripten binding method "+t+" on deleted object"),Te(e.$$.ptr,e.$$.ptrType.registeredClass,r.registeredClass)}function Bt(e,r,t,n,s,l,f,o,u,d){r=O(r),s=V(n,s),J([],[e],function(v){v=v[0];var h=v.name+"."+r,y={get:function(){de("Cannot access "+h+" due to unbound types",[t,f])},enumerable:!0,configurable:!0};return u?y.set=()=>{de("Cannot access "+h+" due to unbound types",[t,f])}:y.set=A=>{m(h+" is a read-only property")},Object.defineProperty(v.registeredClass.instancePrototype,r,y),J([],u?[t,f]:[t],function(A){var F=A[0],j={get:function(){var W=Pr(this,v,h+" getter");return F.fromWireType(s(l,W))},enumerable:!0};if(u){u=V(o,u);var E=A[1];j.set=function(W){var pe=Pr(this,v,h+" setter"),L=[];u(d,pe,E.toWireType(L,W)),wr(L)}}return Object.defineProperty(v.registeredClass.instancePrototype,r,j),[]}),[]})}var Ke=[],R=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Tr(e){e>4&&--R[e].refcount===0&&(R[e]=void 0,Ke.push(e))}function Vt(){for(var e=0,r=5;r<R.length;++r)R[r]!==void 0&&++e;return e}function zt(){for(var e=5;e<R.length;++e)if(R[e]!==void 0)return R[e];return null}function Gt(){a.count_emval_handles=Vt,a.get_first_emval=zt}var Fe={toValue:e=>(e||m("Cannot use deleted val. handle = "+e),R[e].value),toHandle:e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var r=Ke.length?Ke.pop():R.length;return R[r]={refcount:1,value:e},r}}}};function qt(e,r){r=O(r),M(e,{name:r,fromWireType:function(t){var n=Fe.toValue(t);return Tr(t),n},toWireType:function(t,n){return Fe.toHandle(n)},argPackAdvance:8,readValueFromPointer:Ae,destructorFunction:null})}function Qe(e){if(e===null)return"null";var r=typeof e;return r==="object"||r==="array"||r==="function"?e.toString():""+e}function Jt(e,r){switch(r){case 2:return function(t){return this.fromWireType(ir[t>>2])};case 3:return function(t){return this.fromWireType(sr[t>>3])};default:throw new TypeError("Unknown float type: "+e)}}function Xt(e,r,t){var n=Be(t);r=O(r),M(e,{name:r,fromWireType:function(s){return s},toWireType:function(s,l){return l},argPackAdvance:8,readValueFromPointer:Jt(r,n),destructorFunction:null})}function Kt(e,r,t){switch(r){case 0:return t?function(s){return ne[s]}:function(s){return $[s]};case 1:return t?function(s){return ie[s>>1]}:function(s){return _e[s>>1]};case 2:return t?function(s){return G[s>>2]}:function(s){return k[s>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function Qt(e,r,t,n,s){r=O(r);var l=Be(t),f=h=>h;if(n===0){var o=32-8*t;f=h=>h<<o>>>o}var u=r.includes("unsigned"),d=(h,y)=>{},v;u?v=function(h,y){return d(y,this.name),y>>>0}:v=function(h,y){return d(y,this.name),y},M(e,{name:r,fromWireType:f,toWireType:v,argPackAdvance:8,readValueFromPointer:Kt(r,l,n!==0),destructorFunction:null})}function Yt(e,r,t){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],s=n[r];function l(f){f=f>>2;var o=k,u=o[f],d=o[f+1];return new s(te,d,u)}t=O(t),M(e,{name:t,fromWireType:l,argPackAdvance:8,readValueFromPointer:l},{ignoreDuplicateRegistrations:!0})}function Zt(e,r){r=O(r);var t=r==="std::string";M(e,{name:r,fromWireType:function(n){var s=k[n>>2],l=n+4,f;if(t)for(var o=l,u=0;u<=s;++u){var d=l+u;if(u==s||$[d]==0){var v=d-o,h=Q(o,v);f===void 0?f=h:(f+=String.fromCharCode(0),f+=h),o=d+1}}else{for(var y=new Array(s),u=0;u<s;++u)y[u]=String.fromCharCode($[l+u]);f=y.join("")}return H(n),f},toWireType:function(n,s){s instanceof ArrayBuffer&&(s=new Uint8Array(s));var l,f=typeof s=="string";f||s instanceof Uint8Array||s instanceof Uint8ClampedArray||s instanceof Int8Array||m("Cannot pass non-string to std::string"),t&&f?l=Le(s):l=s.length;var o=Ye(4+l+1),u=o+4;if(k[o>>2]=l,t&&f)He(s,u,l+1);else if(f)for(var d=0;d<l;++d){var v=s.charCodeAt(d);v>255&&(H(u),m("String has UTF-16 code units that do not fit in 8 bits")),$[u+d]=v}else for(var d=0;d<l;++d)$[u+d]=s[d];return n!==null&&n.push(H,o),o},argPackAdvance:8,readValueFromPointer:Ae,destructorFunction:function(n){H(n)}})}var Nt=new TextDecoder("utf-16le");function en(e,r){for(var t=e,n=t>>1,s=n+r/2;!(n>=s)&&_e[n];)++n;return t=n<<1,Nt.decode($.subarray(e,t))}function rn(e,r,t){if(t===void 0&&(t=2147483647),t<2)return 0;t-=2;for(var n=r,s=t<e.length*2?t/2:e.length,l=0;l<s;++l){var f=e.charCodeAt(l);ie[r>>1]=f,r+=2}return ie[r>>1]=0,r-n}function tn(e){return e.length*2}function nn(e,r){for(var t=0,n="";!(t>=r/4);){var s=G[e+t*4>>2];if(s==0)break;if(++t,s>=65536){var l=s-65536;n+=String.fromCharCode(55296|l>>10,56320|l&1023)}else n+=String.fromCharCode(s)}return n}function sn(e,r,t){if(t===void 0&&(t=2147483647),t<4)return 0;for(var n=r,s=n+t-4,l=0;l<e.length;++l){var f=e.charCodeAt(l);if(f>=55296&&f<=57343){var o=e.charCodeAt(++l);f=65536+((f&1023)<<10)|o&1023}if(G[r>>2]=f,r+=4,r+4>s)break}return G[r>>2]=0,r-n}function an(e){for(var r=0,t=0;t<e.length;++t){var n=e.charCodeAt(t);n>=55296&&n<=57343&&++t,r+=4}return r}function on(e,r,t){t=O(t);var n,s,l,f,o;r===2?(n=en,s=rn,f=tn,l=()=>_e,o=1):r===4&&(n=nn,s=sn,f=an,l=()=>k,o=2),M(e,{name:t,fromWireType:function(u){for(var d=k[u>>2],v=l(),h,y=u+4,A=0;A<=d;++A){var F=u+4+A*r;if(A==d||v[F>>o]==0){var j=F-y,E=n(y,j);h===void 0?h=E:(h+=String.fromCharCode(0),h+=E),y=F+r}}return H(u),h},toWireType:function(u,d){typeof d!="string"&&m("Cannot pass non-string to C++ string type "+t);var v=f(d),h=Ye(4+v+r);return k[h>>2]=v>>o,s(d,h+4,v+r),u!==null&&u.push(H,h),h},argPackAdvance:8,readValueFromPointer:Ae,destructorFunction:function(u){H(u)}})}function un(e,r){r=O(r),M(e,{isVoid:!0,name:r,argPackAdvance:0,fromWireType:function(){},toWireType:function(t,n){}})}function ln(){throw 1/0}function fn(e){e>4&&(R[e].refcount+=1)}function cn(e,r){var t=q[e];return t===void 0&&m(r+" has unknown type "+br(e)),t}function dn(e,r){e=cn(e,"_emval_take_value");var t=e.readValueFromPointer(r);return Fe.toHandle(t)}function pn(){Y("")}var Ar;Ar=()=>performance.now();function gn(e,r,t){$.copyWithin(e,r,r+t)}function vn(){return 2147483648}function hn(e){try{return K.grow(e-te.byteLength+65535>>>16),ar(K.buffer),1}catch{}}function yn(e){var r=$.length;e=e>>>0;var t=vn();if(e>t)return!1;let n=(u,d)=>u+(d-u%d)%d;for(var s=1;s<=4;s*=2){var l=r*(1+.2/s);l=Math.min(l,e+100663296);var f=Math.min(t,n(Math.max(e,l),65536)),o=hn(f);if(o)return!0}return!1}function mn(e){P(e,new Nr(e))}function bn(e,r){mn(e)}var _n=bn;function wn(e){return 52}function Cn(e,r,t,n){return 52}function Pn(e,r,t,n,s){return 70}var Tn=[null,[],[]];function An(e,r){var t=Tn[e];r===0||r===10?((e===1?re:x)(Me(t,0)),t.length=0):t.push(r)}function $n(e,r,t,n){for(var s=0,l=0;l<t;l++){var f=k[r>>2],o=k[r+4>>2];r+=8;for(var u=0;u<o;u++)An(e,$[f+u]);s+=o}return k[n>>2]=s,0}at(),N=a.BindingError=Ge(Error,"BindingError"),dr=a.InternalError=Ge(Error,"InternalError"),Tt(),ht(),Ut(),mr=a.UnboundTypeError=Ge(Error,"UnboundTypeError"),Gt();var Fn={a:et,n:rt,A:tt,E:nt,l:it,u:st,G:lt,g:It,m:Lt,c:xt,b:Bt,F:qt,o:Xt,f:Qt,d:Yt,p:Zt,k:on,H:un,y:ln,r:Tr,s:fn,q:dn,e:pn,h:Ar,B:gn,z:yn,i:_n,j:wn,D:Cn,t:Pn,C:$n,x:jn,v:On,w:Sn};Zr(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.J).apply(null,arguments)};var Ye=a._malloc=function(){return(Ye=a._malloc=a.asm.K).apply(null,arguments)},H=a._free=function(){return(H=a._free=a.asm.L).apply(null,arguments)},$r=a.___getTypeName=function(){return($r=a.___getTypeName=a.asm.M).apply(null,arguments)};a.__embind_initialize_bindings=function(){return(a.__embind_initialize_bindings=a.asm.N).apply(null,arguments)};var je=a._setThrew=function(){return(je=a._setThrew=a.asm.P).apply(null,arguments)},Se=a.stackSave=function(){return(Se=a.stackSave=a.asm.Q).apply(null,arguments)},Oe=a.stackRestore=function(){return(Oe=a.stackRestore=a.asm.R).apply(null,arguments)};a.dynCall_jiji=function(){return(a.dynCall_jiji=a.asm.S).apply(null,arguments)},a.dynCall_jij=function(){return(a.dynCall_jij=a.asm.T).apply(null,arguments)},a.dynCall_viiiiji=function(){return(a.dynCall_viiiiji=a.asm.U).apply(null,arguments)};function jn(e,r,t){var n=Se();try{return ce(e)(r,t)}catch(s){if(Oe(n),s!==s+0)throw s;je(1,0)}}function Sn(e,r,t,n,s){var l=Se();try{return ce(e)(r,t,n,s)}catch(f){if(Oe(l),f!==f+0)throw f;je(1,0)}}function On(e,r,t,n){var s=Se();try{return ce(e)(r,t,n)}catch(l){if(Oe(s),l!==l+0)throw l;je(1,0)}}var ke;ae=function e(){ke||Fr(),ke||(ae=e)};function Fr(e){if(se>0||(zr(),se>0))return;function r(){ke||(ke=!0,a.calledRun=!0,!me&&(Gr(),w(a),qr()))}r()}return Fr(),a.ready}})();i.exports=p})(En);const Un=Ze,Wr=(i,c)=>{const p=new XMLHttpRequest;return p.open("GET",i,!1),p.responseType=c?"arraybuffer":"text",p.send(null),p.response},Dn=(i,c,p)=>{const g=new XMLHttpRequest;g.open("GET",i,!0),g.responseType="arraybuffer",g.onload=()=>{if((g.status===200||g.status===0)&&g.response)return c(g.response);p()},g.onerror=p,g.send(null)};self.out=i=>{i==="libass: No usable fontconfig configuration file found, using fallback."?console.debug(i):console.log(i)};self.err=i=>{i==="Fontconfig error: Cannot load default config file: No such file: (null)"?console.debug(i):console.error(i)};let he=0;const Rn=1;let z=null,kr=!1,er=Date.now(),Ee=24,Mr=!1,Ir="js",ge={};const Er={};let Wn=0,Hr;self.width=0;self.height=0;let X=!1;self.addFont=({font:i})=>rr(i);const Ne=i=>{if(i=i.trim().toLowerCase(),i.startsWith("@")&&(i=i.substring(1)),!Er[i]){if(Er[i]=!0,!ge[i]&&Mr)return postMessage({target:"getLocalFont",font:i});ge[i]&&rr(ge[i])}},rr=i=>{ArrayBuffer.isView(i)?Ur(i):Dn(i,c=>{Ur(new Uint8Array(c))},console.error)},Ur=i=>{const c=Module._malloc(i.byteLength);Module.HEAPU8.set(i,c),self.jassubObj.addFont("font-"+Wn++,c,i.byteLength),self.jassubObj.reloadFonts()},Lr=i=>{if(!ge)return;const c=Ln(i);for(let C=0;C<c.length;C++)for(let a=0;a<c[C].body.length;a++)c[C].body[a].key==="Style"&&Ne(c[C].body[a].value.Fontname);const p=/\\fn([^\\}]*?)[\\}]/g;let g;for(;(g=p.exec(i))!==null;)Ne(g[1])};self.setTrack=({content:i})=>{Lr(i),self.jassubObj.createTrackMem(i)};self.freeTrack=()=>{self.jassubObj.removeTrack()};self.setTrackByUrl=({url:i})=>{self.setTrack({content:Wr(i)})};const Mn=(i,c)=>{self.width=i,self.height=c,self.jassubObj.resizeCanvas(i,c)},In=()=>{const i=(Date.now()-er)/1e3;return Ue?he:(i>5&&(console.error("Didn't received currentTime > 5 seconds. Assuming video was paused."),xr(!0)),he+i*Rn)},Hn=i=>{he=i,er=Date.now(),z||(kr?z=nr(De):(De(),setTimeout(()=>{kr=!1},20)))};let Ue=!0;const xr=i=>{i!==Ue&&(Ue=i,i?z&&(clearTimeout(z),z=null):(er=Date.now(),z=nr(De)))},tr=(i,c)=>{const p=Date.now();let g=null;if(Ir==="wasm"?(g=self.jassubObj.renderBlend(i,c),g&&(g.times={renderTime:Date.now()-p-(g&&g.time)|0,blendTime:(g&&g.time)|0})):(g=self.jassubObj.renderImage(i,c),g&&(g.times={renderTime:Date.now()-p-(g&&g.time)|0,cppDecodeTime:(g&&g.time)|0})),g&&(self.jassubObj.changed!==0||c)){const C=[];let a=[];const w=Date.now();if(X){const _=[];for(let b=g,P=0;P<self.jassubObj.count;b=b.next,++P)b.image&&(C.push({w:b.w,h:b.h,x:b.x,y:b.y}),_.push(createImageBitmap(new ImageData(new Uint8ClampedArray(Module.HEAPU8).subarray(b.image,b.image+b.w*b.h*4),b.w,b.h))));Promise.all(_).then(b=>{for(let P=0;P<C.length;P++)C[P].image=b[P];a=b,Dr({images:C,buffers:a,times:g.times,decodeStartTime:w})})}else{for(let _=g,b=0;b<self.jassubObj.count;_=_.next,++b)if(_.image){const P={w:_.w,h:_.h,x:_.x,y:_.y,image:_.image};if(!ee){const T=buffer.slice(_.image,_.image+_.w*_.h*4);a.push(T),P.image=T}C.push(P)}Dr({images:C,buffers:a,times:g.times,decodeStartTime:w})}}else postMessage({target:"unbusy"})};self.demand=({time:i})=>{he=i,tr(i)};const De=i=>{z=0,tr(In(),i),Ue||(z=nr(De))},Dr=({times:i,images:c,decodeStartTime:p,buffers:g})=>{if(i.decodeTime=Date.now()-p,ee){const C=Date.now();ve.width=self.width,ve.height!==self.height&&(ve.height=self.height),ee.clearRect(0,0,self.width,self.height);for(const a of c)a.image&&(X?(ee.drawImage(a.image,a.x,a.y),a.image.close()):(self.bufferCanvas.width=a.w,self.bufferCanvas.height=a.h,self.bufferCtx.putImageData(new ImageData(new Uint8ClampedArray(Module.HEAPU8).subarray(a.image,a.image+a.w*a.h*4),a.w,a.h),0,0),ee.drawImage(self.bufferCanvas,a.x,a.y)));if(Hr){i.drawTime=Date.now()-C;let a=0;for(const w in i)a+=i[w];console.log("Bitmaps: "+c.length+" Total: "+Math.round(a)+"ms",i)}postMessage({target:"unbusy"})}else postMessage({target:"render",async:X,images:c,times:i,width:self.width,height:self.height},g)},Ln=i=>{let c,p,g,C,a,w,_,b,P,T;const U=[],S=i.split(/[\r\n]+/g);for(b=0;b<S.length;b++)if(c=S[b].match(/^\[(.*)\]$/),c)p=null,U.push({name:c[1],body:[]});else{if(/^\s*$/.test(S[b])||U.length===0)continue;if(T=U[U.length-1].body,S[b][0]===";")T.push({type:"comment",value:S[b].substring(1)});else{if(C=S[b].split(":"),a=C[0],w=C.slice(1).join(":").trim(),(p||a==="Format")&&(w=w.split(","),p&&w.length>p.length&&(g=w.slice(p.length-1).join(","),w=w.slice(0,p.length-1),w.push(g)),w=w.map(re=>re.trim()),p)){for(_={},P=0;P<w.length;P++)_[p[P]]=w[P];w=_}a==="Format"&&(p=w),T.push({key:a,value:w})}}return U},nr=(()=>{let i=0;return c=>{const p=Date.now();if(i===0)i=p+1e3/Ee;else for(;p+2>=i;)i+=1e3/Ee;const g=Math.max(i-p,0);return setTimeout(c,g)}})(),Re=(i,c)=>{for(const p of Object.keys(i))c[p]=i[p]};let Rr;self.preInit=async i=>{Rr=i.publicPath,globalThis.Module=await Un({locateFile:c=>`${Rr||""}${c.replace("/dist","")}`}),postMessage({target:"ready"})};self.init=i=>{self.publicPath=i.publicPath,self.width=i.width,self.height=i.height,Ir=i.blendMode,X=i.asyncRender,X&&typeof createImageBitmap>"u"&&(X=!1,console.error("'createImageBitmap' needed for 'asyncRender' unsupported!")),ge=i.availableFonts,Hr=i.debug,Ee=i.targetFps||Ee,Mr=i.useLocalFonts;const c=i.fallbackFont.toLowerCase();self.jassubObj=new Module.JASSUB(self.width,self.height,c||null),c&&Ne(c);let p=i.subContent;p||(p=Wr(i.subUrl)),Lr(p);for(const g of i.fonts||[])rr(g);self.jassubObj.createTrackMem(p),self.jassubObj.setDropAnimations(i.dropAllAnimations),(i.libassMemoryLimit>0||i.libassGlyphLimit>0)&&self.jassubObj.setMemoryLimits(i.libassGlyphLimit||0,i.libassMemoryLimit||0)};self.canvas=({width:i,height:c,force:p})=>{if(i==null)throw new Error("Invalid canvas size specified");Mn(i,c),p&&tr(he)};self.video=({currentTime:i,isPaused:c,rate:p})=>{i!=null&&Hn(i),c!=null&&xr(c),p=p||p};let ve,ee;self.offscreenCanvas=({transferable:i})=>{ve=i[0],ee=ve.getContext("2d",{desynchronized:!0}),X||(self.bufferCanvas=new OffscreenCanvas(self.height,self.width),self.bufferCtx=self.bufferCanvas.getContext("2d",{desynchronized:!0}))};self.destroy=()=>{self.jassubObj.quitLibrary()};self.createEvent=({event:i})=>{Re(i,self.jassubObj.getEvent(self.jassubObj.allocEvent()))};self.getEvents=()=>{const i=[];for(let c=0;c<self.jassubObj.getEventCount();c++){const{Start:p,Duration:g,ReadOrder:C,Layer:a,Style:w,MarginL:_,MarginR:b,MarginV:P,Name:T,Text:U,Effect:S}=self.jassubObj.getEvent(c);i.push({Start:p,Duration:g,ReadOrder:C,Layer:a,Style:w,MarginL:_,MarginR:b,MarginV:P,Name:T,Text:U,Effect:S})}postMessage({target:"getEvents",events:i})};self.setEvent=({event:i,index:c})=>{Re(i,self.jassubObj.getEvent(c))};self.removeEvent=({index:i})=>{self.jassubObj.removeEvent(i)};self.createStyle=({style:i})=>{Re(i,self.jassubObj.getStyle(self.jassubObj.allocStyle()))};self.getStyles=()=>{const i=[];for(let c=0;c<self.jassubObj.getStyleCount();c++){const{Name:p,FontName:g,FontSize:C,PrimaryColour:a,SecondaryColour:w,OutlineColour:_,BackColour:b,Bold:P,Italic:T,Underline:U,StrikeOut:S,ScaleX:re,ScaleY:x,Spacing:ye,Angle:K,BorderStyle:me,Outline:We,Shadow:be,Alignment:Me,MarginL:Q,MarginR:Ie,MarginV:He,Encoding:Le,treat_fontname_as_pattern:te,Blur:ne,Justify:$}=self.jassubObj.getStyle(c);i.push({Name:p,FontName:g,FontSize:C,PrimaryColour:a,SecondaryColour:w,OutlineColour:_,BackColour:b,Bold:P,Italic:T,Underline:U,StrikeOut:S,ScaleX:re,ScaleY:x,Spacing:ye,Angle:K,BorderStyle:me,Outline:We,Shadow:be,Alignment:Me,MarginL:Q,MarginR:Ie,MarginV:He,Encoding:Le,treat_fontname_as_pattern:te,Blur:ne,Justify:$})}postMessage({target:"getStyles",time:Date.now(),styles:i})};self.setStyle=({style:i,index:c})=>{Re(i,self.jassubObj.getStyle(c))};self.removeStyle=({index:i})=>{self.jassubObj.removeStyle(i)};onmessage=({data:i})=>{if(self[i.target])self[i.target](i);else throw new Error("Unknown event target "+i.target)};
